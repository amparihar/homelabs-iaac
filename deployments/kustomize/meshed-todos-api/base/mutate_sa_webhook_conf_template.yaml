---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: MutatingWebhookConfiguration
metadata:
    name: pod-sa
    annotations:
        cert-manager.io/inject-ca-from: todos-api/client-cert
webhooks:
    - name: pod-sa.mytodos.com
      sideEffects: None
      admissionReviewVersions: ["v1", "v1beta1"]
      matchPolicy: Equivalent
      faliurePolicy: Fail
      namespaceSelector:
        matchLabels:
            mutate-sa: true
      rules:
        - operations: ["CREATE", "UPDATE"]
          apiGroups: [""]
          apiVersions: ["v1"]
          resources: ["pods"]
          scope: Namespaced
      clientConfig:
        service:
            namespace: todos-api
            name: pod-sa
            path: /mutate
    
---